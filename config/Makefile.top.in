#
# Top level Makefile Template for xosview.
#
#
# $Id$
#
include Makefile.config

OBJS = \
llist.o \
Host.o \
xwin.o \
Xrm.o \
defaultstring.o \
meter.o \
fieldmeter.o \
fieldmeterdecay.o \
bitmeter.o \
xosview.o \
main.o

CFILES := $(OBJS:.o=.cc)
DEPFILES := $(OBJS:%=.%.d)

INSTALL            = @INSTALL@

#-----------------------------------------------------------------------

all : meterlib xosview

defaultstring.cc: Xdefaults defresources.awk
	@AWK@ -f defresources.awk Xdefaults > defaultstring.cc

meterlib:
	@if [ @host_os@ = freebsd ]; then \
	  echo "Creating symlinks in freebsd dir to netbsd dir..."; \
	  cd @top_srcdir@/@host_os@ && $(MAKE) makelinks; \
	fi
	cd @top_srcdir@/@host_os@ && $(MAKE)

@top_srcdir@/@host_os@/libmeter.a: meterlib

xosview: $(OBJS) @top_srcdir@/@host_os@/libmeter.a
	$(CXX) $(LFLAGS) -o xosview $(OBJS) $(LIBS)

##  If for some reason (such as permissions) you wish to change where
##    xosview is installed, modify X11BASEDIR here to point to your
##    desired tree (i.e., "X11BASEDIR=/usr/local"), or simply set the PREFIX
##    variable.
##  The sed command strips off the last portion of the path.  Without
##    the double-quotes around the colons, the $: gets mis-parsed.
##  I think we can use the dirname program for this, but I don't know
##    how standard it is.  bgrayson
X11INCLUDESDIR=@x_includes@ 
##  If $(PREFIX) is already set, use that, otherwise do some 
##  auto-detect based on the x_includes var provided via configure to
##  X11INCLUDESDIR above.
PREFIX_TO_USE=`if [ x"$(PREFIX)" != x ]; then echo $(PREFIX); \
                else echo $(X11INCLUDESDIR) | sed -e 's:/[^/]*$$::'; \
		fi`
BINDIR=$(PREFIX_TO_USE)/bin
MANDIR=$(PREFIX_TO_USE)/man/man1
XAPPLOADDIR=$(PREFIX_TO_USE)/lib/X11/app-defaults

##  These next lines look really ugly.  The echo statements are an
##    attempt to make the output look a little nicer.  The "echo -n"
##    statements create a two-space indent at the beginning of the line.
install: xosview
	@echo "Installing executable..."; echo -n "  "
	@INSTALL_PROGRAM@ @INSTALL_ARGS@ xosview $(BINDIR)
	@echo "Installing application defaults..."; echo -n "  "
	@INSTALL_DATA@ Xdefaults $(XAPPLOADDIR)/XOsview
	@echo "Making sure $(MANDIR) exists..."
	@if [ ! -d $(MANDIR) ]; then \
	  echo "Making $(MANDIR)..."; \
	  mkdir $(MANDIR); \
	fi
	@echo "Installing man page..."; echo -n "  "
	@INSTALL_DATA@ xosview.1 $(MANDIR)

install-man:
	@echo "Use the 'install' target -- it installs the man page, too."
	@#@INSTALL_DATA@ xosview.1 $(MANDIR)

distrib: distclean
	cd @top_srcdir@/..;tar cf `basename $(PWD)`.tar `basename $(PWD)`; \
        gzip -9 `basename $(PWD)`.tar

#  The next one is only used by bgrayson to set up the local
#  mirrors of the xosview distributions.
distrib-and-copy: distrib
	cp ../`basename $(PWD)`.tar.gz ~bgrayson/public_html/xosview
	scp ../`basename $(PWD)`.tar.gz omni:~bgrayson/public_html/xosview

clean :
	cd @host_os@ && $(MAKE) clean
	@#  Only clean the config directory if it exists...
	sh -c 'if [ -d config ]; then \
	    cd config && $(MAKE) clean; fi'
	rm -f xosview $(OBJS) $(DEPFILES) *~ defaultstring.cc

distclean: clean
	rm -f Makefile Makefile.config Makefile.GNU.autodep \
           @host_os@/Makefile config.cache config.log config.status

maintainer-clean: distclean
	rm -f configure

@AUTODEPEND@
